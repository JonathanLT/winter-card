{% extends "base" %}

{% block title %}ğŸ… Secret Santa{% endblock %}

{% block content %}
    <h1>ğŸ… Secret Santa</h1>

    <p>
        Le <strong>Secret Santa</strong> (ou Â« PÃ¨re NoÃ«l secret Â» en franÃ§ais) est un jeu ou une tradition populaire pendant la pÃ©riode de NoÃ«l,
        souvent organisÃ© entre amis, collÃ¨gues ou membres dâ€™une famille. Voici le <strong>principe</strong> :
    </p>

    <ol>
        <li><strong>ğŸ Tirage au sort anonyme</strong>
            <ul>
                <li>Chaque participant tire au hasard le nom dâ€™une autre personne du groupe.</li>
                <li>Il devient alors le Â« Secret Santa Â» (le PÃ¨re NoÃ«l secret) de cette personne.</li>
                <li>Lâ€™identitÃ© de celui qui offre le cadeau reste <strong>secrÃ¨te</strong> jusquâ€™Ã  la fin.</li>
            </ul>
        </li>
        <li><strong>ğŸ’¡ Budget fixÃ© Ã  lâ€™avance</strong>
            <ul><li>Le groupe sâ€™accorde sur un <strong>montant maximum</strong> pour que les cadeaux soient Ã©quitables.</li></ul>
        </li>
        <li><strong>ğŸ€ Achat et Ã©change des cadeaux</strong>
            <ul><li>Chacun achÃ¨te un petit cadeau pour la personne tirÃ©e au sort.</li></ul>
        </li>
        <li><strong>ğŸ¤« Option : garder le secret ou le rÃ©vÃ©ler</strong>
            <ul><li>Parfois on garde le secret, parfois on rÃ©vÃ¨le Ã  la fin.</li></ul>
        </li>
    </ol>

    <div class="note">
        ğŸ‘‰ Le but principal est de <strong>partager un moment amusant et chaleureux</strong> sans que chacun ait Ã  acheter pour tout le monde.
    </div>

    <div style="margin-top:20px;">
      <!-- bouton de tirage : contient l'id utilisateur connectÃ© -->
      <button class="btn btn-success" id="drawBtn" {{ draw_button_state }} data-user-id="{{ user_id }}">Tirer au sort</button>
      <span id="drawResult" style="margin-left:12px;"></span>
    </div>

    <div {{ hidden_draw }}>
        Vous devez offrir Ã  : {{ receiver_name }} !
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function draw() {
        const btn = document.getElementById('drawBtn');
        const userId = btn.getAttribute('data-user-id');
        if (!userId) {
            alert('ID utilisateur non disponible.');
            return;
        }
        console.log('ID utilisateur :', Number(userId));
        btn.disabled = true;
        const res = await fetch('/secret_santa/api/draw', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: Number(userId) })
        });
        if (!res.ok) {
            const text = await res.text();
            document.getElementById('drawResult').textContent = 'Erreur: ' + res.status + ' ' + text;
            return;
        }
        const json = await res.json();
        document.getElementById('drawResult').textContent = 'Vous devez offrir Ã  : ' + json.assigned_name + ' !';
    }

    document.getElementById('drawBtn').addEventListener('click', draw);
</script>
{% endblock %}